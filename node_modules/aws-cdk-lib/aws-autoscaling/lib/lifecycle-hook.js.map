{
  "version": 3,
  "sources": ["lifecycle-hook.ts"],
  "sourcesContent": ["import * as iam from '../../aws-iam';\nimport { Duration, IResource, Resource } from '../../core';\nimport { Construct } from 'constructs';\nimport { IAutoScalingGroup } from './auto-scaling-group';\nimport { CfnLifecycleHook } from './autoscaling.generated';\nimport { ILifecycleHookTarget } from './lifecycle-hook-target';\n\n                                                \nexport interface BasicLifecycleHookProps {\n                                                                                              \n  readonly lifecycleHookName?: string;\n\n                                                                                                                                                                \n  readonly defaultResult?: DefaultResult;\n\n                                                                                                                                                                                                                     \n  readonly heartbeatTimeout?: Duration;\n\n                                                                                                     \n  readonly lifecycleTransition: LifecycleTransition;\n\n                                                                                                       \n  readonly notificationMetadata?: string;\n\n                                                                                 \n  readonly notificationTarget?: ILifecycleHookTarget;\n\n                                                                                                                                                                               \n  readonly role?: iam.IRole;\n}\n\n                                          \nexport interface LifecycleHookProps extends BasicLifecycleHookProps {\n                                                                  \n  readonly autoScalingGroup: IAutoScalingGroup;\n}\n\n                                        \nexport interface ILifecycleHook extends IResource {\n                                                                                                                                                                                    \n  readonly role: iam.IRole;\n}\n\n                                   \nexport class LifecycleHook extends Resource implements ILifecycleHook {\n  private _role?: iam.IRole;\n\n                                                                                                                                                                                                            \n  public get role() {\n    if (!this._role) {\n      throw new Error('\\'role\\' is undefined. Please specify a \\'role\\' or specify a \\'notificationTarget\\' to have a role provided for you.');\n    }\n\n    return this._role;\n  }\n\n                                                                \n  public readonly lifecycleHookName: string;\n\n  constructor(scope: Construct, id: string, props: LifecycleHookProps) {\n    super(scope, id, {\n      physicalName: props.lifecycleHookName,\n    });\n\n    const targetProps = props.notificationTarget ? props.notificationTarget.bind(this, { lifecycleHook: this, role: props.role }) : undefined;\n\n    if (props.role) {\n      this._role = props.role;\n\n      if (!props.notificationTarget) {\n        throw new Error(\"'notificationTarget' parameter required when 'role' parameter is specified\");\n      }\n    } else {\n      this._role = targetProps ? targetProps.createdRole : undefined;\n    }\n\n    const l1NotificationTargetArn = targetProps ? targetProps.notificationTargetArn : undefined;\n    const l1RoleArn = this._role ? this.role.roleArn : undefined;\n\n    const resource = new CfnLifecycleHook(this, 'Resource', {\n      autoScalingGroupName: props.autoScalingGroup.autoScalingGroupName,\n      defaultResult: props.defaultResult,\n      heartbeatTimeout: props.heartbeatTimeout && props.heartbeatTimeout.toSeconds(),\n      lifecycleHookName: this.physicalName,\n      lifecycleTransition: props.lifecycleTransition,\n      notificationMetadata: props.notificationMetadata,\n      notificationTargetArn: l1NotificationTargetArn,\n      roleArn: l1RoleArn,\n    });\n\n    // A LifecycleHook resource is going to do a permissions test upon creation,\n    // so we have to make sure the role has full permissions before creating the\n    // lifecycle hook.\n    if (this._role) {\n      resource.node.addDependency(this.role);\n    }\n\n    this.lifecycleHookName = resource.ref;\n  }\n}\n\nexport enum DefaultResult {\n  CONTINUE = 'CONTINUE',\n  ABANDON = 'ABANDON',\n}\n\n                                                         \nexport enum LifecycleTransition {\n                                                                       \n  INSTANCE_LAUNCHING = 'autoscaling:EC2_INSTANCE_LAUNCHING',\n\n                                                                            \n  INSTANCE_TERMINATING = 'autoscaling:EC2_INSTANCE_TERMINATING',\n}\n"],
  "mappings": "sQACA,OAAA,QAAA,cAGA,wBAAA,QAAA,2BAwCA,2BAAmC,QAAA,QAAQ,CAezC,YAAY,MAAkB,GAAY,MAAyB,CACjE,MAAM,MAAO,GAAI,CACf,aAAc,MAAM,kGAGtB,KAAM,aAAc,MAAM,mBAAqB,MAAM,mBAAmB,KAAK,KAAM,CAAE,cAAe,KAAM,KAAM,MAAM,OAAU,OAEhI,GAAI,MAAM,MAGR,GAFA,KAAK,MAAQ,MAAM,KAEf,CAAC,MAAM,mBACT,KAAM,IAAI,OAAM,kFAGlB,MAAK,MAAQ,YAAc,YAAY,YAAc,OAGvD,KAAM,yBAA0B,YAAc,YAAY,sBAAwB,OAC5E,UAAY,KAAK,MAAQ,KAAK,KAAK,QAAU,OAE7C,SAAW,GAAI,yBAAA,iBAAiB,KAAM,WAAY,CACtD,qBAAsB,MAAM,iBAAiB,qBAC7C,cAAe,MAAM,cACrB,iBAAkB,MAAM,kBAAoB,MAAM,iBAAiB,YACnE,kBAAmB,KAAK,aACxB,oBAAqB,MAAM,oBAC3B,qBAAsB,MAAM,qBAC5B,sBAAuB,wBACvB,QAAS,YAMX,AAAI,KAAK,OACP,SAAS,KAAK,cAAc,KAAK,MAGnC,KAAK,kBAAoB,SAAS,OAjDzB,OAAI,CACb,GAAI,CAAC,KAAK,MACR,KAAM,IAAI,OAAM,mHAGlB,MAAO,MAAK,OAThB,QAAA,cAAA,wHAyDA,GAAY,eAAZ,AAAA,UAAY,eAAa,CACvB,eAAA,SAAA,WACA,eAAA,QAAA,YAFU,cAAA,QAAA,eAAA,SAAA,cAAa,KAMzB,GAAY,qBAAZ,AAAA,UAAY,qBAAmB,CAE7B,qBAAA,mBAAA,qCAGA,qBAAA,qBAAA,yCALU,oBAAA,QAAA,qBAAA,SAAA,oBAAmB",
  "names": []
}
