{
  "version": 3,
  "sources": ["deploy-action.ts"],
  "sourcesContent": ["import * as codepipeline from '../../../aws-codepipeline';\nimport * as s3 from '../../../aws-s3';\nimport { Duration } from '../../../core';\nimport { kebab as toKebabCase } from 'case';\nimport { Construct } from 'constructs';\nimport { Action } from '../action';\nimport { deployArtifactBounds } from '../common';\n\n// Class copied verbatim from the aws-s3-deployment module.\n// Yes, it sucks that we didn't abstract this properly in a common class,\n// but having 2 different CacheControl classes that behave differently would be worse I think.\n// Something to do when CDK 2.0.0 comes out.\n                                                                                                                                                                                                                                                                                                                \nexport class CacheControl {\n                                                       \n  public static mustRevalidate() { return new CacheControl('must-revalidate'); }\n                                                \n  public static noCache() { return new CacheControl('no-cache'); }\n                                                    \n  public static noTransform() { return new CacheControl('no-transform'); }\n                                              \n  public static setPublic() { return new CacheControl('public'); }\n                                               \n  public static setPrivate() { return new CacheControl('private'); }\n                                                        \n  public static proxyRevalidate() { return new CacheControl('proxy-revalidate'); }\n                                               \n  public static maxAge(t: Duration) { return new CacheControl(`max-age=${t.toSeconds()}`); }\n                                                 \n  public static sMaxAge(t: Duration) { return new CacheControl(`s-maxage=${t.toSeconds()}`); }\n                                                                                                                                                    \n  public static fromString(s: string) { return new CacheControl(s); }\n\n  /** @param value the actual text value of the created directive */\n  private constructor(public value: string) {}\n}\n\n                                                                                  \nexport interface S3DeployActionProps extends codepipeline.CommonAwsActionProps {\n                                                                                                                     \n  readonly extract?: boolean;\n\n                                                                                    \n  readonly objectKey?: string;\n\n                                                           \n  readonly input: codepipeline.Artifact;\n\n                                                                \n  readonly bucket: s3.IBucket;\n\n                                                                                                                                                                                              \n  readonly accessControl?: s3.BucketAccessControl;\n\n                                                                                                                                                                                                                                                                                                      \n  readonly cacheControl?: CacheControl[];\n}\n\n                                                   \nexport class S3DeployAction extends Action {\n  private readonly props: S3DeployActionProps;\n\n  constructor(props: S3DeployActionProps) {\n    super({\n      ...props,\n      resource: props.bucket,\n      category: codepipeline.ActionCategory.DEPLOY,\n      provider: 'S3',\n      artifactBounds: deployArtifactBounds(),\n      inputs: [props.input],\n    });\n\n    this.props = props;\n  }\n\n  protected bound(_scope: Construct, _stage: codepipeline.IStage, options: codepipeline.ActionBindOptions):\n  codepipeline.ActionConfig {\n    // pipeline needs permissions to write to the S3 bucket\n    this.props.bucket.grantWrite(options.role);\n\n    if (this.props.accessControl !== undefined) {\n      // we need to modify the ACL settings of objects within the Bucket,\n      // so grant the Action's Role permissions to do that\n      this.props.bucket.grantPutAcl(options.role);\n    }\n\n    // the Action Role also needs to read from the Pipeline's bucket\n    options.bucket.grantRead(options.role);\n\n    const acl = this.props.accessControl;\n    return {\n      configuration: {\n        BucketName: this.props.bucket.bucketName,\n        Extract: this.props.extract === false ? 'false' : 'true',\n        ObjectKey: this.props.objectKey,\n        CannedACL: acl ? toKebabCase(acl.toString()) : undefined,\n        CacheControl: this.props.cacheControl && this.props.cacheControl.map(ac => ac.value).join(', '),\n      },\n    };\n  }\n}\n"],
  "mappings": "gPAAA,aAAA,QAAA,6BAGA,OAAA,QAAA,QAEA,SAAA,QAAA,aACA,SAAA,QAAA,aAOA,kBAAyB,CAqBvB,YAA2B,MAAa,CAAb,KAAA,MAAA,YAnBb,iBAAc,CAAK,MAAO,IAAI,cAAa,yBAE3C,UAAO,CAAK,MAAO,IAAI,cAAa,kBAEpC,cAAW,CAAK,MAAO,IAAI,cAAa,sBAExC,YAAS,CAAK,MAAO,IAAI,cAAa,gBAEtC,aAAU,CAAK,MAAO,IAAI,cAAa,iBAEvC,kBAAe,CAAK,MAAO,IAAI,cAAa,0BAE5C,QAAO,EAAW,CAAA,+BAAA,qBAAA,GAAW,GAAI,cAAa,WAAW,EAAE,qBAE3D,SAAQ,EAAW,CAAA,+BAAA,qBAAA,GAAW,GAAI,cAAa,YAAY,EAAE,qBAE7D,YAAW,EAAS,CAAI,MAAO,IAAI,cAAa,IAlBhE,QAAA,aAAA,8HA8CA,4BAAoC,UAAA,MAAM,CAGxC,YAAY,MAA0B,CACpC,MAAM,IACD,MACH,SAAU,MAAM,OAChB,SAAU,aAAa,eAAe,OACtC,SAAU,KACV,eAAgB,SAAA,uBAChB,OAAQ,CAAC,MAAM,iGAGjB,KAAK,MAAQ,MAGL,MAAM,OAAmB,OAA6B,QAAuC,qJAGrG,KAAK,MAAM,OAAO,WAAW,QAAQ,MAEjC,KAAK,MAAM,gBAAkB,QAG/B,KAAK,MAAM,OAAO,YAAY,QAAQ,MAIxC,QAAQ,OAAO,UAAU,QAAQ,MAEjC,KAAM,KAAM,KAAK,MAAM,cACvB,MAAO,CACL,cAAe,CACb,WAAY,KAAK,MAAM,OAAO,WAC9B,QAAS,KAAK,MAAM,UAAY,GAAQ,QAAU,OAClD,UAAW,KAAK,MAAM,UACtB,UAAW,IAAM,OAAA,MAAY,IAAI,YAAc,OAC/C,aAAc,KAAK,MAAM,cAAgB,KAAK,MAAM,aAAa,IAAI,IAAM,GAAG,OAAO,KAAK,SArClG,QAAA,eAAA",
  "names": []
}
