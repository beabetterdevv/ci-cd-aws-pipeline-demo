{
  "version": 3,
  "sources": ["virtual-service.ts"],
  "sourcesContent": ["import * as cdk from '../../core';\nimport { Construct } from 'constructs';\nimport { CfnVirtualService } from './appmesh.generated';\nimport { IMesh, Mesh } from './mesh';\nimport { renderMeshOwner } from './private/utils';\nimport { IVirtualNode } from './virtual-node';\nimport { IVirtualRouter } from './virtual-router';\n\n                                                                                         \nexport interface IVirtualService extends cdk.IResource {\n                                                                    \n  readonly virtualServiceName: string;\n\n                                                                                            \n  readonly virtualServiceArn: string;\n\n                                                             \n  readonly mesh: IMesh;\n}\n\n                                                                     \nexport interface VirtualServiceProps {\n                                                                                                                                                                                                                                                                                        \n  readonly virtualServiceName?: string;\n\n                                                                                               \n  readonly virtualServiceProvider: VirtualServiceProvider;\n}\n\n                                                                                                                                                                                                                                \nexport class VirtualService extends cdk.Resource implements IVirtualService {\n                                                               \n  public static fromVirtualServiceArn(scope: Construct, id: string, virtualServiceArn: string): IVirtualService {\n    return new class extends cdk.Resource implements IVirtualService {\n      readonly virtualServiceArn = virtualServiceArn;\n      private readonly parsedArn = cdk.Fn.split('/', cdk.Stack.of(scope).splitArn(virtualServiceArn, cdk.ArnFormat.SLASH_RESOURCE_NAME).resourceName!);\n      readonly virtualServiceName = cdk.Fn.select(2, this.parsedArn);\n      readonly mesh = Mesh.fromMeshName(this, 'Mesh', cdk.Fn.select(0, this.parsedArn));\n    }(scope, id);\n  }\n\n                                                                       \n  public static fromVirtualServiceAttributes(scope: Construct, id: string, attrs: VirtualServiceAttributes): IVirtualService {\n    return new class extends cdk.Resource implements IVirtualService {\n      readonly virtualServiceName = attrs.virtualServiceName;\n      readonly mesh = attrs.mesh;\n      readonly virtualServiceArn = cdk.Stack.of(this).formatArn({\n        service: 'appmesh',\n        resource: `mesh/${attrs.mesh.meshName}/virtualService`,\n        resourceName: this.virtualServiceName,\n      });\n    }(scope, id);\n  }\n\n                                                                                                                       \n  public readonly virtualServiceName: string;\n\n                                                                       \n  public readonly virtualServiceArn: string;\n\n                                                             \n  public readonly mesh: IMesh;\n\n  constructor(scope: Construct, id: string, props: VirtualServiceProps) {\n    super(scope, id, {\n      physicalName: props.virtualServiceName || cdk.Lazy.string({ produce: () => cdk.Names.uniqueId(this) }),\n    });\n\n    const providerConfig = props.virtualServiceProvider.bind(this);\n    this.mesh = providerConfig.mesh;\n\n    const svc = new CfnVirtualService(this, 'Resource', {\n      meshName: this.mesh.meshName,\n      meshOwner: renderMeshOwner(this.env.account, this.mesh.env.account),\n      virtualServiceName: this.physicalName,\n      spec: {\n        provider: providerConfig.virtualNodeProvider || providerConfig.virtualRouterProvider\n          ? {\n            virtualNode: providerConfig.virtualNodeProvider,\n            virtualRouter: providerConfig.virtualRouterProvider,\n          }\n          : undefined,\n      },\n    });\n\n    this.virtualServiceName = this.getResourceNameAttribute(svc.attrVirtualServiceName);\n    this.virtualServiceArn = this.getResourceArnAttribute(svc.ref, {\n      service: 'appmesh',\n      resource: `mesh/${this.mesh.meshName}/virtualService`,\n      resourceName: this.physicalName,\n    });\n  }\n}\n\n                                                                                   \nexport interface VirtualServiceAttributes {\n                                                                                                                       \n  readonly virtualServiceName: string;\n\n                                                             \n  readonly mesh: IMesh;\n}\n\n                                                   \nexport interface VirtualServiceProviderConfig {\n                                                                      \n  readonly virtualNodeProvider?: CfnVirtualService.VirtualNodeServiceProviderProperty;\n\n                                                                        \n  readonly virtualRouterProvider?: CfnVirtualService.VirtualRouterServiceProviderProperty;\n\n                                                                     \n  readonly mesh: IMesh;\n}\n\n                                                                                       \nexport abstract class VirtualServiceProvider {\n                                                                          \n  public static virtualNode(virtualNode: IVirtualNode): VirtualServiceProvider {\n    return new VirtualServiceProviderImpl(virtualNode, undefined);\n  }\n\n                                                                            \n  public static virtualRouter(virtualRouter: IVirtualRouter): VirtualServiceProvider {\n    return new VirtualServiceProviderImpl(undefined, virtualRouter);\n  }\n\n                                                                                                                                                    \n  public static none(mesh: IMesh): VirtualServiceProvider {\n    return new VirtualServiceProviderImpl(undefined, undefined, mesh);\n  }\n\n                                                                               \n  public abstract bind(_construct: Construct): VirtualServiceProviderConfig;\n}\n\nclass VirtualServiceProviderImpl extends VirtualServiceProvider {\n  private readonly virtualNode?: IVirtualNode;\n  private readonly virtualRouter?: IVirtualRouter;\n  private readonly mesh: IMesh;\n\n  constructor(virtualNode?: IVirtualNode, virtualRouter?: IVirtualRouter, mesh?: IMesh) {\n    super();\n    this.virtualNode = virtualNode;\n    this.virtualRouter = virtualRouter;\n    const providedMesh = this.virtualNode?.mesh ?? this.virtualRouter?.mesh ?? mesh!;\n    this.mesh = providedMesh;\n  }\n\n  public bind(_construct: Construct): VirtualServiceProviderConfig {\n    return {\n      mesh: this.mesh,\n      virtualNodeProvider: this.virtualNode\n        ? {\n          virtualNodeName: this.virtualNode.virtualNodeName,\n        }\n        : undefined,\n      virtualRouterProvider: this.virtualRouter\n        ? {\n          virtualRouterName: this.virtualRouter.virtualRouterName,\n        }\n        : undefined,\n    };\n  }\n}\n"],
  "mappings": "uPAAA,IAAA,QAAA,cAEA,oBAAA,QAAA,uBACA,OAAA,QAAA,UACA,QAAA,QAAA,mBA0BA,4BAAoC,KAAI,QAAQ,CAiC9C,YAAY,MAAkB,GAAY,MAA0B,CAClE,MAAM,MAAO,GAAI,CACf,aAAc,MAAM,oBAAsB,IAAI,KAAK,OAAO,CAAE,QAAS,IAAM,IAAI,MAAM,SAAS,qFAGhG,KAAM,gBAAiB,MAAM,uBAAuB,KAAK,MACzD,KAAK,KAAO,eAAe,KAE3B,KAAM,KAAM,GAAI,qBAAA,kBAAkB,KAAM,WAAY,CAClD,SAAU,KAAK,KAAK,SACpB,UAAW,QAAA,gBAAgB,KAAK,IAAI,QAAS,KAAK,KAAK,IAAI,SAC3D,mBAAoB,KAAK,aACzB,KAAM,CACJ,SAAU,eAAe,qBAAuB,eAAe,sBAC3D,CACA,YAAa,eAAe,oBAC5B,cAAe,eAAe,uBAE9B,UAIR,KAAK,mBAAqB,KAAK,yBAAyB,IAAI,wBAC5D,KAAK,kBAAoB,KAAK,wBAAwB,IAAI,IAAK,CAC7D,QAAS,UACT,SAAU,QAAQ,KAAK,KAAK,0BAC5B,aAAc,KAAK,qBAzDT,uBAAsB,MAAkB,GAAY,kBAAyB,CACzF,MAAO,IAAI,cAAc,KAAI,QAAQ,CAA1B,aAAA,qBACA,KAAA,kBAAoB,kBACZ,KAAA,UAAY,IAAI,GAAG,MAAM,IAAK,IAAI,MAAM,GAAG,OAAO,SAAS,kBAAmB,IAAI,UAAU,qBAAqB,cACzH,KAAA,mBAAqB,IAAI,GAAG,OAAO,EAAG,KAAK,WAC3C,KAAA,KAAO,OAAA,KAAK,aAAa,KAAM,OAAQ,IAAI,GAAG,OAAO,EAAG,KAAK,cACtE,MAAO,UAIG,8BAA6B,MAAkB,GAAY,MAA+B,wFAC/F,GAAI,cAAc,KAAI,QAAQ,CAA1B,aAAA,qBACA,KAAA,mBAAqB,MAAM,mBAC3B,KAAA,KAAO,MAAM,KACb,KAAA,kBAAoB,IAAI,MAAM,GAAG,MAAM,UAAU,CACxD,QAAS,UACT,SAAU,QAAQ,MAAM,KAAK,0BAC7B,aAAc,KAAK,uBAErB,MAAO,KArBb,QAAA,eAAA,uHAsFA,4BAA4C,OAE5B,aAAY,YAAyB,kFAC1C,GAAI,4BAA2B,YAAa,cAIvC,eAAc,cAA6B,sFAChD,GAAI,4BAA2B,OAAW,qBAIrC,MAAK,KAAW,oEACrB,GAAI,4BAA2B,OAAW,OAAW,OAbhE,QAAA,uBAAA,+IAoBA,wCAAyC,uBAAsB,CAK7D,YAAY,YAA4B,cAAgC,KAAY,iBAClF,QACA,KAAK,YAAc,YACnB,KAAK,cAAgB,cACrB,KAAM,cAAY,IAAA,IAAA,IAAG,KAAK,eAAW,MAAA,KAAA,OAAA,OAAA,GAAE,QAAI,MAAA,KAAA,OAAA,GAAA,IAAI,KAAK,iBAAa,MAAA,KAAA,OAAA,OAAA,GAAE,QAAI,MAAA,KAAA,OAAA,GAAI,KAC3E,KAAK,KAAO,aAGP,KAAK,WAAqB,CAC/B,MAAO,CACL,KAAM,KAAK,KACX,oBAAqB,KAAK,YACtB,CACA,gBAAiB,KAAK,YAAY,iBAElC,OACJ,sBAAuB,KAAK,cACxB,CACA,kBAAmB,KAAK,cAAc,mBAEtC",
  "names": []
}
