{
  "version": 3,
  "sources": ["start-job-run.ts"],
  "sourcesContent": ["import * as path from 'path';\nimport * as iam from '../../../aws-iam';\nimport * as lambda from '../../../aws-lambda';\nimport * as logs from '../../../aws-logs';\nimport * as s3 from '../../../aws-s3';\nimport * as sfn from '../../../aws-stepfunctions';\nimport { TaskInput } from '../../../aws-stepfunctions';\nimport * as cdk from '../../../core';\nimport * as cr from '../../../custom-resources';\nimport * as awscli from '../../../lambda-layer-awscli';\nimport { Construct } from 'constructs';\nimport { integrationResourceArn, validatePatternSupported } from '../private/task-utils';\n\n                                                           \nexport interface EmrContainersStartJobRunProps extends sfn.TaskStateBaseProps {\n                                                                        \n  readonly virtualCluster: VirtualClusterInput;\n\n                                                                              \n  readonly jobName?: string;\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n  readonly executionRole?: iam.IRole;\n\n                                                                       \n  readonly releaseLabel: ReleaseLabel;\n\n                                                                                                                                                                                                                                                          \n  readonly applicationConfig?: ApplicationConfiguration[];\n\n                                                                                                                                             \n  readonly jobDriver: JobDriver;\n\n                                                                                                                                                                                                                                                                                        \n  readonly monitoring?: Monitoring;\n\n                                                                         \n  readonly tags?: { [key: string]: string };\n}\n\n                                                                                                                                                                                                                                                                                                                                                                      \nexport class EmrContainersStartJobRun extends sfn.TaskStateBase implements iam.IGrantable {\n  private static readonly SUPPORTED_INTEGRATION_PATTERNS: sfn.IntegrationPattern[] = [\n    sfn.IntegrationPattern.REQUEST_RESPONSE,\n    sfn.IntegrationPattern.RUN_JOB,\n  ];\n\n  protected readonly taskMetrics?: sfn.TaskMetricsConfig;\n  protected readonly taskPolicies?: iam.PolicyStatement[];\n\n  public readonly grantPrincipal: iam.IPrincipal;\n  private role: iam.IRole;\n  private readonly logGroup?: logs.ILogGroup;\n  private readonly logBucket?: s3.IBucket;\n  private readonly integrationPattern: sfn.IntegrationPattern;\n\n  constructor(scope: Construct, id: string, private readonly props: EmrContainersStartJobRunProps) {\n    super(scope, id, props);\n    this.integrationPattern = props.integrationPattern ?? sfn.IntegrationPattern.RUN_JOB;\n    validatePatternSupported(this.integrationPattern, EmrContainersStartJobRun.SUPPORTED_INTEGRATION_PATTERNS);\n\n    if (this.props.applicationConfig) {\n      this.validateAppConfig(this.props.applicationConfig);\n    }\n\n    if (this.props.jobDriver.sparkSubmitJobDriver) {\n      this.validateSparkSubmitJobDriver(props.jobDriver.sparkSubmitJobDriver);\n    }\n\n    if (this.props.executionRole === undefined\n      && sfn.JsonPath.isEncodedJsonPath(props.virtualCluster.id)) {\n      throw new Error('Execution role cannot be undefined when the virtual cluster ID is not a concrete value. Provide an execution role with the correct trust policy');\n    }\n\n    this.logGroup = this.assignLogGroup();\n    this.logBucket = this.assignLogBucket();\n    this.role = this.props.executionRole ?? this.createJobExecutionRole();\n    this.grantPrincipal = this.role;\n\n    this.grantMonitoringPolicies();\n\n    this.taskPolicies = this.createPolicyStatements();\n  }\n\n  /**\n   * @internal\n   */\n  protected _renderTask(): any {\n    return {\n      Resource: integrationResourceArn('emr-containers', 'startJobRun', this.integrationPattern),\n      Parameters: sfn.FieldUtils.renderObject({\n        VirtualClusterId: this.props.virtualCluster.id,\n        Name: this.props.jobName,\n        ExecutionRoleArn: this.role.roleArn,\n        ReleaseLabel: this.props.releaseLabel.label,\n        JobDriver: {\n          SparkSubmitJobDriver: {\n            EntryPoint: this.props.jobDriver.sparkSubmitJobDriver?.entryPoint.value,\n            EntryPointArguments: this.props.jobDriver.sparkSubmitJobDriver?.entryPointArguments?.value,\n            SparkSubmitParameters: this.props.jobDriver.sparkSubmitJobDriver?.sparkSubmitParameters,\n          },\n        },\n        ConfigurationOverrides: {\n          ApplicationConfiguration: cdk.listMapper(this.applicationConfigPropertyToJson)(this.props.applicationConfig),\n          MonitoringConfiguration: {\n            CloudWatchMonitoringConfiguration: this.logGroup ? {\n              LogGroupName: this.logGroup.logGroupName,\n              LogStreamNamePrefix: this.props.monitoring!.logStreamNamePrefix,\n            } : undefined,\n            PersistentAppUI: (this.props.monitoring?.persistentAppUI === false)\n              ? 'DISABLED'\n              : 'ENABLED',\n            S3MonitoringConfiguration: this.logBucket ? {\n              LogUri: this.logBucket.s3UrlForObject(),\n            } : undefined,\n          },\n        },\n        Tags: this.props.tags,\n      }),\n    };\n  }\n\n  /**\n   * Render the EMR Containers ConfigurationProperty as JSON\n   */\n  private applicationConfigPropertyToJson = (property: ApplicationConfiguration) => {\n    return {\n      Classification: cdk.stringToCloudFormation(property.classification.classificationStatement),\n      Properties: property.properties ? cdk.objectToCloudFormation(property.properties) : undefined,\n      Configurations: property.nestedConfig ? cdk.listMapper(this.applicationConfigPropertyToJson)(property.nestedConfig) : undefined,\n    };\n  }\n\n  private validateAppConfigPropertiesLength(appConfig: ApplicationConfiguration) {\n    if (appConfig?.properties === undefined) {\n      return;\n    } else if (Object.keys(appConfig.properties).length > 100) {\n      throw new Error(`Application configuration properties must have 100 or fewer entries. Received ${Object.keys(appConfig.properties).length}`);\n    }\n  }\n\n  private validatePropertiesNestedAppConfigBothNotUndefined(appConfig: ApplicationConfiguration) {\n    if (appConfig?.properties === undefined && appConfig?.nestedConfig === undefined) {\n      throw new Error('Application configuration must have either properties or nested app configurations defined.');\n    }\n  }\n\n  private validateAppConfig(config?: ApplicationConfiguration[]) {\n    if (config === undefined) {\n      return;\n    } else if (config.length > 100) {\n      throw new Error(`Application configuration array must have 100 or fewer entries. Received ${config.length}`);\n    } else {\n      config.forEach(element => this.validateAppConfig(element.nestedConfig));\n      config.forEach(element => this.validateAppConfigPropertiesLength(element));\n      config.forEach(element => this.validatePropertiesNestedAppConfigBothNotUndefined(element));\n    }\n  }\n\n  private isArrayOfStrings(value: any): boolean {\n    return Array.isArray(value) && value.every(item => typeof item === 'string');\n  }\n\n  private validateEntryPointArguments (entryPointArguments:sfn.TaskInput) {\n    if (typeof entryPointArguments.value === 'string' && !sfn.JsonPath.isEncodedJsonPath(entryPointArguments.value)) {\n      throw new Error(`Entry point arguments must be a string array or encoded JSON path, but received a non JSON path string');\n      .`);\n    }\n    if (!this.isArrayOfStrings(entryPointArguments.value)) {\n      throw new Error(`Entry point arguments must be a string array or encoded JSON path but received ${typeof entryPointArguments.value}.`);\n    }\n  }\n\n  private validateEntryPointArgumentsLength (entryPointArguments:sfn.TaskInput) {\n    if (this.isArrayOfStrings(entryPointArguments.value)\n        && (entryPointArguments.value.length > 10280 || entryPointArguments.value.length < 1)) {\n      throw new Error(`Entry point arguments must be a string array between 1 and 10280 in length. Received ${entryPointArguments.value.length}.`);\n    }\n  }\n\n  private validateSparkSubmitParametersLength (sparkSubmitParameters : string) {\n    if (sparkSubmitParameters.length > 102400 || sparkSubmitParameters.length < 1) {\n      throw new Error(`Spark submit parameters must be between 1 and 102400 characters in length. Received ${sparkSubmitParameters.length}.`);\n    }\n  }\n  private validateEntryPoint (entryPoint: TaskInput) {\n    if (!sfn.JsonPath.isEncodedJsonPath(entryPoint.value) && (entryPoint.value.length > 256|| entryPoint.value.length < 1)) {\n      throw new Error(`Entry point must be between 1 and 256 characters in length. Received ${entryPoint.value.length}.`);\n    }\n  }\n\n  private validateSparkSubmitJobDriver (driver:SparkSubmitJobDriver) {\n    this.validateEntryPoint(driver.entryPoint);\n    if (driver.entryPointArguments) {\n      this.validateEntryPointArguments(driver.entryPointArguments);\n      this.validateEntryPointArgumentsLength(driver.entryPointArguments);\n    }\n    if (driver.sparkSubmitParameters) {\n      this.validateSparkSubmitParametersLength(driver.sparkSubmitParameters);\n    }\n  }\n\n  private assignLogGroup = () : any => {\n    if (this.props.monitoring?.logGroup) {\n      return (this.props.monitoring?.logGroup);\n    } else {\n      return (this.props.monitoring?.logging ? new logs.LogGroup(this, 'Monitoring Log Group') : undefined);\n    }\n  }\n\n  private assignLogBucket = () : any => {\n    if (this.props.monitoring?.logBucket) {\n      return (this.props.monitoring?.logBucket);\n    } else {\n      return (this.props.monitoring?.logging ? new s3.Bucket(this, 'Monitoring Bucket') : undefined);\n    }\n  }\n\n  // https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/creating-job-execution-role.html\n  private createJobExecutionRole(): iam.Role {\n    const jobExecutionRole = new iam.Role(this, 'Job-Execution-Role', {\n      assumedBy: new iam.CompositePrincipal(\n        new iam.ServicePrincipal('emr-containers.amazonaws.com'),\n        new iam.ServicePrincipal('states.amazonaws.com'),\n      ),\n    });\n\n    this.logBucket?.grantReadWrite(jobExecutionRole);\n    this.logGroup?.grantWrite(jobExecutionRole);\n    this.logGroup?.grant(jobExecutionRole, 'logs:DescribeLogStreams');\n\n    jobExecutionRole.addToPrincipalPolicy(\n      new iam.PolicyStatement({\n        resources: [\n          'arn:aws:logs:*:*:*',\n        ],\n        actions: [\n          'logs:DescribeLogGroups',\n        ],\n      }),\n    );\n\n    this.updateRoleTrustPolicy(jobExecutionRole);\n\n    return jobExecutionRole;\n  }\n  private grantMonitoringPolicies() {\n\n    this.logBucket?.grantReadWrite(this.role);\n    this.logGroup?.grantWrite(this.role);\n    this.logGroup?.grant(this.role, 'logs:DescribeLogStreams');\n\n    this.role.addToPrincipalPolicy(\n      new iam.PolicyStatement({\n        resources: [\n          'arn:aws:logs:*:*:*',\n        ],\n        actions: [\n          'logs:DescribeLogGroups',\n        ],\n      }),\n    );\n  }\n\n  /**\n   * If an execution role is not provided by user, the automatically generated job execution role must create a trust relationship\n   * between itself and the identity of the EMR managed service account in order to run jobs on the Kubernetes namespace.\n   *\n   * This cannot occur if the user provided virtualClusterId is within an encoded JSON path.\n   *\n   * The trust relationship can be created by updating the trust policy of the job execution role.\n   *\n   * @param role the automatically generated job execution role\n   */\n  private updateRoleTrustPolicy(role: iam.Role) {\n    const eksClusterInfo = new cr.AwsCustomResource(this, 'GetEksClusterInfo', {\n      onCreate: {\n        service: 'EMRcontainers',\n        action: 'describeVirtualCluster',\n        parameters: {\n          id: this.props.virtualCluster.id,\n        },\n        outputPaths: ['virtualCluster.containerProvider.info.eksInfo.namespace', 'virtualCluster.containerProvider.id'],\n        physicalResourceId: cr.PhysicalResourceId.of('id'),\n      },\n      policy: cr.AwsCustomResourcePolicy.fromSdkCalls({\n        resources: cr.AwsCustomResourcePolicy.ANY_RESOURCE,\n      }),\n    });\n    /* We make use of custom resources to call update-roll-trust-policy as this command is only available through\n     * aws cli because this is only used during the initial setup and is not available through the sdk.\n     * https://awscli.amazonaws.com/v2/documentation/api/latest/reference/emr-containers/update-role-trust-policy.html\n     * Commands available through SDK: https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/EMRcontainers.html\n     * Commands available through CLI: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/emr-containers/index.html\n    */\n    const cliLayer = new awscli.AwsCliLayer(this, 'awsclilayer');\n    const shellCliLambda = new lambda.SingletonFunction(this, 'Call Update-Role-Trust-Policy', {\n      uuid: '8693BB64-9689-44B6-9AAF-B0CC9EB8757C',\n      runtime: lambda.Runtime.PYTHON_3_6,\n      handler: 'index.handler',\n      code: lambda.Code.fromAsset(path.join(__dirname, 'utils/role-policy')),\n      timeout: cdk.Duration.seconds(30),\n      memorySize: 256,\n      layers: [cliLayer],\n    });\n    shellCliLambda.addToRolePolicy(\n      new iam.PolicyStatement({\n        resources: [\n          cdk.Stack.of(this).formatArn({\n            service: 'eks',\n            resource: 'cluster',\n            resourceName: eksClusterInfo.getResponseField('virtualCluster.containerProvider.id'),\n          }),\n        ],\n        actions: [\n          'eks:DescribeCluster',\n        ],\n      }),\n    );\n    shellCliLambda.addToRolePolicy(\n      new iam.PolicyStatement({\n        resources: [role.roleArn],\n        actions: [\n          'iam:GetRole',\n          'iam:UpdateAssumeRolePolicy',\n        ],\n      }),\n    );\n    const provider = new cr.Provider(this, 'CustomResourceProvider', {\n      onEventHandler: shellCliLambda,\n    });\n    new cdk.CustomResource(this, 'Custom Resource', {\n      properties: {\n        eksNamespace: eksClusterInfo.getResponseField('virtualCluster.containerProvider.info.eksInfo.namespace'),\n        eksClusterId: eksClusterInfo.getResponseField('virtualCluster.containerProvider.id'),\n        roleName: role.roleName,\n      },\n      serviceToken: provider.serviceToken,\n    });\n  }\n\n  private createPolicyStatements(): iam.PolicyStatement[] {\n    const policyStatements = [\n      new iam.PolicyStatement({\n        resources: [\n          cdk.Stack.of(this).formatArn({\n            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_SLASH_RESOURCE_NAME,\n            service: 'emr-containers',\n            resource: 'virtualclusters',\n            resourceName: sfn.JsonPath.isEncodedJsonPath(this.props.virtualCluster.id) ? '*' : this.props.virtualCluster.id, // Need wild card for dynamic start job run https://docs.aws.amazon.com/step-functions/latest/dg/emr-eks-iam.html\n          }),\n        ],\n        actions: ['emr-containers:StartJobRun'],\n        conditions: {\n          StringEquals: {\n            'emr-containers:ExecutionRoleArn': this.role.roleArn,\n          },\n        },\n      }),\n    ];\n\n    if (this.integrationPattern === sfn.IntegrationPattern.RUN_JOB) {\n      policyStatements.push(\n        new iam.PolicyStatement({\n          resources: [\n            cdk.Stack.of(this).formatArn({\n              arnFormat: cdk.ArnFormat.SLASH_RESOURCE_SLASH_RESOURCE_NAME,\n              service: 'emr-containers',\n              resource: 'virtualclusters',\n              resourceName: sfn.JsonPath.isEncodedJsonPath(this.props.virtualCluster.id) ? '*' : `${this.props.virtualCluster.id}/jobruns/*`, // Need wild card for dynamic start job run https://docs.aws.amazon.com/step-functions/latest/dg/emr-eks-iam.html\n            }),\n          ],\n          actions: [\n            'emr-containers:DescribeJobRun',\n            'emr-containers:CancelJobRun',\n          ],\n        }),\n      );\n    }\n\n    return policyStatements;\n  }\n}\n\n                                                             \nexport interface SparkSubmitJobDriver {\n                                                                                                                              \n  readonly entryPoint: sfn.TaskInput;\n\n                                                                                                                                                                                                                                                                                                      \n  readonly entryPointArguments?: sfn.TaskInput;\n\n                                                                                                                                                                                                     \n  readonly sparkSubmitParameters?: string;\n}\n\n                                                                                                                                              \nexport interface JobDriver {\n                                                                                                                                                                                   \n  readonly sparkSubmitJobDriver: SparkSubmitJobDriver;\n}\n\n                                                                                                                                                                                      \nexport class Classification {\n                                                                                                                                                                                                                                                                                                                                                           \n  static readonly SPARK = new Classification('spark');\n\n                                                                                                                                                        \n  static readonly SPARK_DEFAULTS = new Classification('spark-defaults');\n\n                                                                                                                                                                       \n  static readonly SPARK_ENV = new Classification('spark-env');\n\n                                                            \n  static readonly SPARK_HIVE_SITE = new Classification('spark-hive-site');\n\n                                                                                                                                                                                     \n  static readonly SPARK_LOG4J = new Classification('spark-log4j');\n\n                                                                                                                                                                                         \n  static readonly SPARK_METRICS = new Classification('spark-metrics');\n\n                                                                                                                                                                             \n  constructor(public readonly classificationStatement: string) { }\n}\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \nexport interface ApplicationConfiguration {\n                                                                                                                                      \n  readonly classification: Classification;\n\n                                                                                                                                                                                               \n  readonly nestedConfig?: ApplicationConfiguration[];\n\n                                                                                                                                                                            \n  readonly properties?: { [key: string]: string };\n}\n\n                                                \nexport interface Monitoring {\n                                                                                                                                                                                                                                                                                                                                             \n  readonly logging?: boolean\n\n                                                                                                                                                                                                                                                                                      \n  readonly logGroup?: logs.ILogGroup;\n\n                                                                                                                                                      \n  readonly logStreamNamePrefix?: string;\n\n                                                                                                                                                                                                                                                                                           \n  readonly logBucket?: s3.IBucket;\n\n                                                                                                     \n  readonly persistentAppUI?: boolean;\n}\n\n                                                                                                                                                                               \nexport class ReleaseLabel {\n                                           \n  static readonly EMR_5_32_0 = new ReleaseLabel('emr-5.32.0-latest');\n\n                                           \n  static readonly EMR_5_33_0 = new ReleaseLabel('emr-5.33.0-latest');\n\n                                          \n  static readonly EMR_6_2_0 = new ReleaseLabel('emr-6.2.0-latest');\n\n                                          \n  static readonly EMR_6_3_0 = new ReleaseLabel('emr-6.3.0-latest');\n\n                                                                                                                                               \n  constructor(public readonly label: string) { }\n}\n\n                                                                            \nexport class VirtualClusterInput {\n                                                               \n  static fromTaskInput(taskInput: sfn.TaskInput): VirtualClusterInput {\n    return new VirtualClusterInput(taskInput.value);\n  }\n\n                                                                 \n  static fromVirtualClusterId(virtualClusterId: string): VirtualClusterInput {\n    return new VirtualClusterInput(virtualClusterId);\n  }\n\n  /**\n   * Initializes the virtual cluster ID.\n   *\n   * @param id The VirtualCluster Id\n   */\n  private constructor(public readonly id: string) { }\n}"],
  "mappings": "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",
  "names": []
}
